# Book Compressor - System Overview

**AI Book Compressor** is a Python CLI script that summarizes books (PDF/EPUB) to reduce reading time. It uses Large Language Models to condense text while **simultaneously translating it into any target language**, attempting to preserve the main narrative and key points.

**Note**: While the system supports testing with any OpenRouter model, the prompts and chunking logic are **specifically optimized for Google's Gemini models**.

## Key Features

*   **Prompt Structure**: Uses concise Markdown lists to minimize token usage and improve instruction following.
*   **Content Sampling**: Samples text from three different parts of the book (10%, 45%, 80%) to classify it as fiction or non-fiction.
*   **Text Splitting**: Splits text at chapter or paragraph boundaries to fit within model context limits.
*   **Output Verification**: Generates multiple drafts per chunk and selects the one closest to the target word count.

## Prerequisites

1.  **OpenRouter API Key**: You must have an `OPENROUTER_API_KEY` environment variable set.
2.  **Dependencies**: Install the required Python packages:
    ```bash
    pip install -r requirements.txt
    ```

## Usage
1.  Place your books (`.pdf` or `.epub`) in the **`Input/`** directory.
2.  Run the batch script with your preferred configuration:
3.  Find your processed files in the **`Output/`** directory (filenames match input, with changed extension).

### Examples

**1. Default (50% compression, Slovak, Gemini Flash):**
```powershell
./compressor.bat
```

**2. Target Reading Time (e.g., 60 minutes):**
```powershell
./compressor.bat -M 60
```

**3. Specific Compression Ratio (e.g., 20%):**
```powershell
./compressor.bat -r 0.2
```

**4. Pro Usage (Gemini Pro, German, Reading Format):**
> *Note: Using the Pro model increases costs significantly and may not yield proportional quality improvements over Flash.*
```powershell
./compressor.bat -m "google/gemini-pro-1.5" -l "German" -f reading
```

### Full Configuration Parameters

| Flag | Parameter | Description | Default |
| :--- | :--- | :--- | :--- |
| **`-M`** | `--target_minutes` | Total desired listening/reading time in minutes (at ~150 wpm). **Overrides `-r`**. | *None* |
| **`-r`** | `--ratio` | Compression/Expansion Ratio (0.001 - 2.0). Values >1.0 expand content. Ignored if using `-M`. | `0.5` |
| **`-p`** | `--process_limit` | Percentage of the book to process (0.1 - 100). Useful for testing. | `100.0` |
| **`-m`** | `--model` | OpenRouter Model ID (e.g. `google/gemini-3-flash-preview`, `anthropic/claude-3-5-sonnet`). | `google/gemini-3-flash-preview` |
| **`-f`** | `--format` | Output style: `tts` (plain text) or `reading` (markdown headers). | `tts` |
| **`-l`** | `--language` | Target output language. | `Slovak` |
| **`-t`** | `--temperature` | LLM Temperature (0.0 = Strict, 1.0 = Creative). | *Model Default* |
| **`-F`** | `--focus` | Thematic focus keywords (comma-separated) to prioritize in output. E.g., `magic,spells`. | *None* |
| **`-a`** | `--attempts` | Number of draft attempts per chunk (1-5). Uses adaptive target compensation. | `2` |
| **`-T`** | `--add_title` | Prepend the filename (underscores removed, Title Cased) as a title line at the start of the output. | *False* |

## Credits

This project, including both code and documentation, was 99% generated by **GitHub Copilot** and **Antigravity AI**.

